# GetX 상태관리 기초

## 상태관리란?

상태관리는 앱의 데이터가 변경될 때 UI를 자동으로 업데이트하는 방법입니다.

## GetX 상태관리의 3가지 방법

### 1. Reactive Programming (반응형 프로그래밍)

가장 권장되는 방법으로, `.obs`를 사용합니다.

#### 기본 사용법

```dart
class CounterController extends GetxController {
  // .obs로 반응형 변수 선언 (final 사용 권장)
  final count = 0.obs;
  final name = "홍길동".obs;
  final isVisible = true.obs;

  void increment() {
    count.value++; // .value로 값 변경
  }

  void changeName(String newName) {
    name.value = newName;
  }

  void toggleVisibility() {
    isVisible.value = !isVisible.value;
  }
}
```

**💡 왜 final을 사용할까요?**

- **안전성**: 실수로 인스턴스를 재할당하는 것을 방지
- **성능**: 컴파일러 최적화 가능
- **일관성**: GetX 권장 패턴

#### UI에서 사용하기

```dart
class HomePage extends StatelessWidget {
  final CounterController controller = Get.put(CounterController());

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('GetX 상태관리')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            // Obx()로 반응형 UI 생성
            Obx(() => Text(
              '카운트: ${controller.count.value}',
              style: TextStyle(fontSize: 24),
            )),

            Obx(() => Text(
              '이름: ${controller.name.value}',
              style: TextStyle(fontSize: 18),
            )),

            Obx(() => Visibility(
              visible: controller.isVisible.value,
              child: Text('보이는 텍스트'),
            )),

            SizedBox(height: 20),

            ElevatedButton(
              onPressed: controller.increment,
              child: Text('증가'),
            ),

            ElevatedButton(
              onPressed: () => controller.changeName('김철수'),
              child: Text('이름 변경'),
            ),

            ElevatedButton(
              onPressed: controller.toggleVisibility,
              child: Text('보이기/숨기기'),
            ),
          ],
        ),
      ),
    );
  }
}
```

### 2. Simple State Management (간단한 상태관리)

`GetBuilder`를 사용하는 방법입니다.

```dart
class SimpleController extends GetxController {
  int count = 0;

  void increment() {
    count++;
    update(); // UI 업데이트 트리거
  }

  void decrement() {
    count--;
    update();
  }
}
```

```dart
class SimplePage extends StatelessWidget {
  final SimpleController controller = Get.put(SimpleController());

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('간단한 상태관리')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            GetBuilder<SimpleController>(
              builder: (controller) => Text(
                '카운트: ${controller.count}',
                style: TextStyle(fontSize: 24),
              ),
            ),

            SizedBox(height: 20),

            ElevatedButton(
              onPressed: controller.increment,
              child: Text('증가'),
            ),

            ElevatedButton(
              onPressed: controller.decrement,
              child: Text('감소'),
            ),
          ],
        ),
      ),
    );
  }
}
```

### 3. GetX Controller (컨트롤러 패턴)

가장 체계적인 방법으로, 비즈니스 로직을 분리합니다.

```dart
class UserController extends GetxController {
  // 반응형 변수들 (final 사용 권장)
  final users = <User>[].obs;
  final isLoading = false.obs;
  final errorMessage = ''.obs;

  @override
  void onInit() {
    super.onInit();
    fetchUsers(); // 앱 시작시 사용자 목록 가져오기
  }

  void fetchUsers() async {
    isLoading.value = true;
    errorMessage.value = '';

    try {
      // API 호출 시뮬레이션
      await Future.delayed(Duration(seconds: 2));
      users.value = [
        User(id: 1, name: '홍길동', email: 'hong@example.com'),
        User(id: 2, name: '김철수', email: 'kim@example.com'),
        User(id: 3, name: '이영희', email: 'lee@example.com'),
      ];
    } catch (e) {
      errorMessage.value = '사용자 목록을 가져오는데 실패했습니다.';
    } finally {
      isLoading.value = false;
    }
  }

  void addUser(User user) {
    users.add(user);
  }

  void removeUser(int id) {
    users.removeWhere((user) => user.id == id);
  }

  void updateUser(User updatedUser) {
    final index = users.indexWhere((user) => user.id == updatedUser.id);
    if (index != -1) {
      users[index] = updatedUser;
    }
  }
}

class User {
  final int id;
  final String name;
  final String email;

  User({required this.id, required this.name, required this.email});
}
```

## 컨트롤러 생명주기

```dart
class LifecycleController extends GetxController {
  @override
  void onInit() {
    super.onInit();
    print('컨트롤러가 초기화되었습니다.');
  }

  @override
  void onReady() {
    super.onReady();
    print('컨트롤러가 준비되었습니다.');
  }

  @override
  void onClose() {
    print('컨트롤러가 종료되었습니다.');
    super.onClose();
  }
}
```

## 컨트롤러 관리 방법

### 1. Get.put() - 항상 새로 생성

```dart
final controller = Get.put(CounterController());
```

### 2. Get.lazyPut() - 필요할 때 생성

```dart
Get.lazyPut(() => CounterController());
final controller = Get.find<CounterController>();
```

### 3. Get.create() - 매번 새로 생성

```dart
Get.create(() => CounterController());
```

### 4. Get.delete() - 컨트롤러 삭제

```dart
Get.delete<CounterController>();
```

## 실전 예제: 할일 관리 앱

```dart
class TodoController extends GetxController {
  final todos = <Todo>[].obs;
  final filter = 'all'.obs; // all, active, completed

  void addTodo(String title) {
    if (title.trim().isNotEmpty) {
      todos.add(Todo(
        id: DateTime.now().millisecondsSinceEpoch,
        title: title.trim(),
        completed: false,
      ));
    }
  }

  void toggleTodo(int id) {
    final todo = todos.firstWhere((todo) => todo.id == id);
    todo.completed = !todo.completed;
    todos.refresh(); // 리스트 업데이트
  }

  void removeTodo(int id) {
    todos.removeWhere((todo) => todo.id == id);
  }

  void setFilter(String newFilter) {
    filter.value = newFilter;
  }

  List<Todo> get filteredTodos {
    switch (filter.value) {
      case 'active':
        return todos.where((todo) => !todo.completed).toList();
      case 'completed':
        return todos.where((todo) => todo.completed).toList();
      default:
        return todos.toList();
    }
  }

  int get activeCount => todos.where((todo) => !todo.completed).length;
  int get completedCount => todos.where((todo) => todo.completed).length;
}

class Todo {
  final int id;
  String title;
  bool completed;

  Todo({
    required this.id,
    required this.title,
    required this.completed,
  });
}
```

## GetX 변수 선언 규칙

### ✅ 권장하는 패턴

```dart
class MyController extends GetxController {
  // 반응형 변수들 - final 사용 (권장)
  final count = 0.obs;
  final name = "사용자".obs;
  final isVisible = true.obs;
  final items = <String>[].obs;
  final user = Rxn<User>();

  // 일반 변수들 - 변경 빈도에 따라 선택
  final userId = 123;           // 변경되지 않는 값
  var tempCalculation = 0;      // 자주 변경되는 값
}
```

### ❌ 피해야 할 패턴

```dart
class MyController extends GetxController {
  // 반응형 변수에서 var 사용 (위험)
  var count = 0.obs;        // ❌ 위험! 인스턴스 재할당 가능
  var name = "사용자".obs;   // ❌ 위험! 인스턴스 재할당 가능
}
```

## 다음 단계

- [03*라우팅*기초.md](03_라우팅_기초.md) - GetX 라우팅 학습
- [04*API_CRUD*기초.md](04_API_CRUD_기초.md) - API 연동 학습
